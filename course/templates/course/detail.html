{% extends 'base.html' %}
{% block head%}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.fa {
  font-size: 18px;
  cursor: pointer;
  user-select: none;
}

.fa:hover {
  color: darkblue;
}



.likebutton {
	  background-color: #FFFFFF; /* Green */
	  font-size: 15px;
}

.centered-and-cropped { 
	object-fit: cover;
	width:100%;
	margin:-10% 0px -20% 0px;
	 }

</style>
{% endblock%}


{% block body %}
<div style="overflow: hidden;margin-top: -20px">
	<img src="{{course.course_pic.url}}" class="centered-and-cropped">
</div>
<div class="container">
	<div class="row">
		<div class="col-md-9" style="padding: 50px 0px 50px 0px; ">
	    <h1 style="font-size: 70px">{{course.title}}</h1>      
	    <p style="font-size: 30px;font-style: italic;font-weight: 100">{{course.desc}}</p>
	    <span style="font-size: 16px; font-weight: 200">{{course.created_on | date:"M d, Y"}}</span>

		</div>
		<div class="col-md-3">
				  <div style="vertical-align:middle;text-align: center;">
					  <div style="margin-top: 100px">
						<img src="{{course.publisher.profile.profile_pic.url }}" class="img-circle" width="50px"> 
					</div>
				<p style="font-size: 18px;font-weight: 400;font-style: italic;">{{course.publisher.profile.full_name}}
								</p>

				</div>

		</div>
	</div>

	<div style="margin-bottom: 15px">
	<button class="likebutton" onclick="myFunction(this)" id="user-like-button"><span id="total_likes">{{course.total_likes}}</span> Likes <i id="user-like" class="fa fa-thumbs-o-up" ></i></button>

	</div>

  	{% for topic in course.sorted_topics.all %}
	<div class="panel-group">
	    <div class="panel panel-primary">
	      <div class="panel-heading" >
	        <h4 class="panel-title">
	          <a data-toggle="collapse" href="#collapse{{topic.id}}">{{topic.title}}</a>
	        </h4>

	      </div>
	      <div id="collapse{{topic.id}}" class="panel-collapse collapse in">
	        <ul class="list-group">
	        	{% for subtopic in topic.sorted_subtopics.all %}
		          <li class="list-group-item">{{subtopic.title}}</li>
	          {% endfor %}
	        </ul>
	      </div>
	    </div>
	  </div>
    {% endfor %}


</div>

<script>
	var clicked = 0
	var original = 0

	console.log(clicked)
	{% for  like in request.user.likes.all %}
		{% if like.id == course.id %}
			clicked =1;
			original=1;
		{% endif %}
	{% endfor %}
	console.log(clicked)

$( document ).ready(set_likes(clicked));


function set_likes(clicked) {
	if (clicked == 1){

	    document.getElementById("user-like").classList="fa fa-thumbs-up"
	}
	else{
	    document.getElementById("user-like").classList="fa fa-thumbs-o-up"
	}


	document.getElementById("total_likes").innerHTML = {{course.total_likes}}+(clicked-original)


}


function myFunction(x) {
	if (clicked == 1){
		clicked = 0;
		updatelike(-1)
	}
	else{
		clicked = 1
		updatelike(1)

	}
	set_likes(clicked)
	   //document.getElementById("user-like").classList.toggle("fa-thumbs-up");


}


function  updatelike(change){
	        // get the value of CSRF token
        var CSRFtoken = $('input[name=csrfmiddlewaretoken]').val();

        var data = {"jaley":"ajay"};

		function getCookie(name) {
		    var cookieValue = null;
		    if (document.cookie && document.cookie !== '') {
		        var cookies = document.cookie.split(';');
		        for (var i = 0; i < cookies.length; i++) {
		            var cookie = jQuery.trim(cookies[i]);
		            // Does this cookie string begin with the name we want?
		            if (cookie.substring(0, name.length + 1) === (name + '=')) {
		                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                break;
		            }
		        }
		    }
		    return cookieValue;
		}


       	$.post("{{course.get_likes_url}}", { 
           "change" :  change,
           csrfmiddlewaretoken: getCookie('csrftoken')	
       });

}


</script>
{% endblock %}
